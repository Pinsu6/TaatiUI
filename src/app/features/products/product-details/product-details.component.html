<main class="mx-auto space-y-6">
  <!-- Loading / Error Demo Changes-->
  <div *ngIf="isLoading" class="flex justify-center items-center py-12">
    <i class="fas fa-spinner fa-spin text-2xl text-tati-burgundy mr-2"></i>
    <span>Loading product...</span>
  </div>
  <div *ngIf="errorMessage" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded text-center">
    {{ errorMessage }}
    <button (click)="retry()" class="ml-2 underline">Retry</button>
  </div>
  <!-- ==================== PROFILE ==================== -->
  <section *ngIf="product && !isLoading && !errorMessage" class="bg-white border shadow rounded-xl p-6 mb-6">
    <div class="flex items-center justify-between mb-6">
      <div>
        <h2 class="text-2xl font-bold text-tati-burgundy">{{ product.drugName }}</h2>
        <p class="text-gray-600 mt-1">SKU: {{ product.drugCode }}</p>
        <div class="mt-2">
          <span class="inline-flex px-3 py-1 rounded-full text-sm font-medium"
                [ngClass]="product.bitIsActive ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'">
            {{ product.bitIsActive ? 'Active' : 'Inactive' }}
          </span>
          <span *ngIf="product.isNarcotic || product.narcotics" class="inline-flex px-3 py-1 rounded-full text-sm font-medium ml-2 bg-orange-100 text-orange-800">
            Narcotic
          </span>
        </div>
      </div>
      <button (click)="goBack()"
              class="px-6 py-2 bg-tati-burgundy text-white rounded-lg hover:bg-opacity-90 transition font-medium">
        Back to List
      </button>
    </div>
    <!-- Two-column grid -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <!-- LEFT – Basic info -->
      <div>
        <div class="mb-6">
          <h3 class="text-lg font-semibold text-tati-burgundy mb-3 border-b border-gray-200 pb-2">Basic Information</h3>
          <div class="space-y-2 text-sm">
            <p><span class="font-medium text-gray-700">Quick Code:</span> <span class="text-gray-500">{{ product.drugQuickcode || 'N/A' }}</span></p>
            <p><span class="font-medium text-gray-700">Category:</span> <span class="text-gray-500">{{ product.drugTypeName || 'N/A' }}</span></p>
            <p><span class="font-medium text-gray-700">Therapeutic Class:</span> <span class="text-gray-500">{{ product.theRapeuticclass || 'N/A' }}</span></p>
            <p><span class="font-medium text-gray-700">NDC Code:</span> <span class="text-gray-500">{{ product.drugNdccode || 'N/A' }}</span></p>
            <p><span class="font-medium text-gray-700">Dosage Form:</span> <span class="text-gray-500">{{ product.dosageFormName || 'N/A' }}</span></p>
            <p><span class="font-medium text-gray-700">Brand:</span> <span class="text-gray-500">{{ product.brandName || 'N/A' }}</span></p>
            <p><span class="font-medium text-gray-700">Pack Size:</span> <span class="text-gray-500">{{ product.quantityPack || 'N/A' }}</span></p>
            <p><span class="font-medium text-gray-700">Strength:</span> <span class="text-gray-500">{{ product.strength || 'N/A' }}</span></p>
            <p><span class="font-medium text-gray-700">Manufacturer:</span> <span class="text-gray-500">{{ product.manufacturerName || 'N/A' }}</span></p>
            <p><span class="font-medium text-gray-700">Created Date:</span> <span class="text-gray-500">{{ product.dateCreated | date:'medium' }}</span></p>
          </div>
        </div>
        <div class="mb-6">
          <h3 class="text-lg font-semibold text-tati-burgundy mb-3 border-b border-gray-200 pb-2">Description</h3>
          <p class="text-sm text-gray-600">{{ (product.drugShort || product.strength) || 'No description available.' }}</p>
        </div>
      </div>
      <!-- RIGHT – Stock & Levels -->
      <div>
        <div class="mb-6">
          <h3 class="text-lg font-semibold text-tati-burgundy mb-3 border-b border-gray-200 pb-2">Stock & Levels</h3>
          <div class="space-y-2 text-sm">
            <p><span class="font-medium text-gray-700">Current Stock:</span> <span class="text-gray-500">{{ (product.stockSummary?.currentStock || 0) | number }}</span></p>
            <p><span class="font-medium text-gray-700">Min Level:</span> <span class="text-gray-500">{{ product.minLevel | number }}</span></p>
            <p><span class="font-medium text-gray-700">Max Level:</span> <span class="text-gray-500">{{ product.maxLevel | number }}</span></p>
            <p><span class="font-medium text-gray-700">Total Purchased:</span> <span class="text-gray-500">{{ (product.stockSummary?.totalPurchased || 0) | number }}</span></p>
            <p><span class="font-medium text-gray-700">Total Sold:</span> <span class="text-gray-500">{{ (product.stockSummary?.totalSold || 0) | number }}</span></p>
            <div class="mt-2">
              <span *ngIf="product.stockSummary?.isLowStock" class="inline-flex px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800">
                Low Stock Alert
              </span>
              <span *ngIf="product.stockSummary?.isOutOfStock" class="inline-flex px-3 py-1 rounded-full text-sm font-medium ml-2 bg-red-100 text-red-800">
                Out of Stock
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ==================== Pricing ==================== -->
  <section *ngIf="product" class="bg-white border shadow rounded-xl p-6 mb-6">
    <h3 class="text-lg font-semibold text-tati-burgundy mb-3 border-b border-gray-200 pb-2">Pricing Details</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="space-y-2 text-sm">
        <p><span class="font-medium text-gray-700">Sale Price:</span> <span class="text-gray-500">SLL {{ (product.pricing?.salePrice || 0) | number }}</span></p>
        <p><span class="font-medium text-gray-700">Unit Cost:</span> <span class="text-gray-500">SLL {{ (product.pricing?.unitCost || product.unitCost || 0) | number }}</span></p>
        <p><span class="font-medium text-gray-700">Margin (%):</span> <span class="text-gray-500">{{ (product.pricing?.marginPercent || 0) | number:'1.2-2' }}%</span></p>
        <p><span class="font-medium text-gray-700">Margin Amount:</span> <span class="text-gray-500">SLL {{ (product.pricing?.marginAmount || product.margin || 0) | number }}</span></p>
      </div>
      <div class="space-y-2 text-sm">
        <p><span class="font-medium text-gray-700">Total Revenue:</span> <span class="text-gray-500">SLL {{ formattedTotalRevenue }}</span></p>
        <p><span class="font-medium text-gray-700">Turnover Rate:</span> <span class="text-gray-500">N/A</span></p>
      </div>
    </div>
  </section>

  <!-- ==================== Manufacturer Details ==================== -->
 <!-- ==================== Manufacturer Details ==================== -->
<section *ngIf="product?.manufacturer" class="bg-white border shadow rounded-xl p-6 mb-6">
  <h3 class="text-lg font-semibold text-tati-burgundy mb-3 border-b border-gray-200 pb-2">Manufacturer Details</h3>
  <div class="space-y-2 text-sm">
    <p><span class="font-medium text-gray-700">Name:</span> <span class="text-gray-500">{{ product?.manufacturer?.manufacturerName || 'N/A' }}</span></p>
    <p><span class="font-medium text-gray-700">MFG:</span> <span class="text-gray-500">{{ product?.manufacturer?.mfg || 'N/A' }}</span></p>
    <p><span class="font-medium text-gray-700">Contact Person:</span> <span class="text-gray-500">{{ product?.manufacturer?.mfgPerson || 'N/A' }}</span></p>
    <p><span class="font-medium text-gray-700">Email:</span> <span class="text-gray-500">{{ product?.manufacturer?.mfgEmail || 'N/A' }}</span></p>
    <p><span class="font-medium text-gray-700">Mobile:</span> <span class="text-gray-500">{{ product?.manufacturer?.mfgMobile || 'N/A' }}</span></p>
  </div>
</section>

  <!-- ==================== Active Batches changes is done  ==================== -->
  <!-- ==================== Active Batches ==================== -->
<!-- ==================== Active Batches ==================== -->
<section *ngIf="product?.activeBatches?.length" class="bg-white rounded-xl shadow border-t-4 border-blue-500 mb-6">
  <div class="p-6 border-b"><h3 class="font-semibold text-blue-600">Active Batches</h3></div>
  <div class="overflow-x-auto">
    <table class="w-full text-sm">
      <thead class="bg-gray-100 text-gray-600 uppercase text-xs">
        <tr>
          <th class="px-6 py-3">Batch No</th>
          <th class="px-6 py-3">Expiry Date</th>
          <th class="px-6 py-3">Remaining Qty</th>
          <th class="px-6 py-3">Status</th>
        </tr>
      </thead>
      <tbody class="divide-y">
        <tr *ngFor="let batch of product?.activeBatches">
          <td class="px-6 py-3">{{ batch.batchNo }}</td>
          <td class="px-6 py-3">{{ batch.expiryDate | date:'medium' }}</td>
          <td class="px-6 py-3">{{ batch.remainingQty | number }}</td>
          <td class="px-6 py-3" [ngClass]="batch.isExpiringSoon ? 'text-red-600' : 'text-green-600'">
            {{ batch.isExpiringSoon ? 'Expiring Soon' : 'Active' }}
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</section>

  <!-- ==================== KPIs ==================== -->
  <section *ngIf="product" class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
    <div class="bg-white p-6 rounded-xl shadow border-t-4 border-tati-burgundy">
      <h3 class="text-gray-500">Total Sold</h3>
      <p class="text-2xl font-bold text-tati-burgundy">{{ (product.stockSummary?.totalSold || 0) | number }}</p>
    </div>
    <div class="bg-white p-6 rounded-xl shadow border-t-4 border-green-500">
      <h3 class="text-gray-500">Total Revenue</h3>
      <p class="text-2xl font-bold text-green-600">SLL {{ formattedTotalRevenueM }}</p>
    </div>
    <div class="bg-white p-6 rounded-xl shadow border-t-4 border-blue-500">
      <h3 class="text-gray-500">Current Stock</h3>
      <p class="text-2xl font-bold text-blue-600">{{ (product.stockSummary?.currentStock || 0) | number }}</p>
    </div>
    <div class="bg-white p-6 rounded-xl shadow border-t-4 border-yellow-500">
      <h3 class="text-gray-500">Turnover Rate</h3>
      <p class="text-2xl font-bold text-yellow-600">N/A</p>
    </div>
  </section>
  <!-- ==================== Charts ==================== -->
  <section *ngIf="product" class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
    <div class="bg-white p-6 rounded-xl shadow border-t-4 border-tati-burgundy">
      <h3 class="font-semibold text-tati-burgundy mb-4">Monthly Sales Trend</h3>
      <div class="chart-container"><canvas #salesTrend></canvas></div>
    </div>
    <div class="bg-white p-6 rounded-xl shadow border-t-4 border-green-500">
      <h3 class="font-semibold text-green-600 mb-4">Regional Sales Distribution</h3>
      <div class="chart-container"><canvas #regionSplit></canvas></div>
    </div>
  </section>
  <!-- ==================== Recent Orders ==================== -->
  <section *ngIf="product" class="bg-white rounded-xl shadow border-t-4 border-blue-500 mb-6">
    <div class="p-6 border-b"><h3 class="font-semibold text-blue-600">Recent Orders Containing this Product</h3></div>
    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead class="bg-gray-100 text-gray-600 uppercase text-xs">
          <tr><th class="px-6 py-3">Order ID</th><th class="px-6 py-3">Date</th>
              <th class="px-6 py-3">Customer</th><th class="px-6 py-3">Qty</th><th class="px-6 py-3">Total</th></tr>
        </thead>
        <tbody class="divide-y">
          <tr *ngFor="let o of orders">
            <td class="px-6 py-3">{{ o.orderId }}</td>
            <td class="px-6 py-3">{{ o.date }}</td>
            <td class="px-6 py-3">{{ o.customer }}</td>
            <td class="px-6 py-3">{{ o.quantity }}</td>
            <td class="px-6 py-3">{{ o.total }}</td>
          </tr>
          <tr *ngIf="!orders.length"><td colspan="5" class="px-6 py-3 text-center text-gray-600">No orders yet.</td></tr>
        </tbody>
      </table>
    </div>
  </section>
  <!-- ==================== Stock Movements ==================== -->
  <section *ngIf="product" class="bg-white rounded-xl shadow border-t-4 border-yellow-500 mb-6">
    <div class="p-6 border-b"><h3 class="font-semibold text-yellow-600">Stock Movements</h3></div>
    <div class="p-6">
      <ul class="list-disc ml-5 text-gray-700">
        <li *ngFor="let m of stockMovements">{{ m.date }}: {{ m.description }}</li>
        <li *ngIf="!stockMovements.length" class="text-gray-600">No movements recorded.</li>
      </ul>
    </div>
  </section>
  <!-- ==================== Promotions / Alerts ==================== -->
  <section *ngIf="product" class="bg-white rounded-xl shadow border-t-4 border-red-500">
    <div class="p-6 border-b"><h3 class="font-semibold text-red-600">Promotions & Alerts</h3></div>
    <div class="p-6">
      <p class="text-gray-700" *ngFor="let a of alerts">{{ a.message }}</p>
      <p *ngIf="!alerts.length" class="text-gray-600">No alerts at the moment.</p>
    </div>
  </section>
</main>
